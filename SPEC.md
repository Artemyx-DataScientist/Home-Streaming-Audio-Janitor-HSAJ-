# SPEC — Home Streaming Audio Janitor

## Цели
- Обеспечить базовую инфраструктуру для разработки мостика (bridge) и ядра (core).
- Зафиксировать ключевые предположения и архитектурные решения.
- Подготовить CI-цепочку, проверяющую качество кода.

## Доменные компоненты
### Bridge
- Получает события/данные от внешних систем (стриминговые платформы, устройства) и приводит их к формату ядра.
- В dev-режиме работает как простой процесс, выводящий логи о старте и маршрутизации.
- Требования: Node.js 18+, ESLint для проверки стиля.

### Core
- Принимает нормализованные события от bridge и реализует доменную логику.
- Должен быть готов к расширению под хранение «first_seen» и обработку вариантов качества (в т.ч. Dolby Atmos).
- Требования: Python 3.11+, `ruff`, `black`, `pytest`.

## Нефункциональные требования
- Репозиторий готов к разработке: описаны шаги запуска, есть архитектурный обзор и ADR.
- CI запускает линтеры и тесты в обоих модулях и проходит на чистой репе.
- Конфигурации линтеров хранить рядом с кодом (`pyproject.toml` для core, `.eslintrc.json` для bridge).

## CI
- GitHub Actions workflow:
  - job `bridge` — `npm ci` и `npm test` в каталоге `bridge`.
  - job `core` — `pip install -r requirements-dev.txt`, `ruff`, `black --check`, `pytest` в каталоге `core`.

## Cross-platform policy / Windows compatibility
- Для всех путей использовать только `pathlib`, избегая конкатенации строк и зависимостей от разделителей.
- `ffprobe_path` должен быть настраиваемым через конфигурацию/переменные окружения, без предположения о системном расположении.
- Имена файлов необходимо санитизировать (убирать недопустимые символы для целевых ОС) перед записью.
- Не должно быть жёсткой зависимости на systemd; при наличии — предусмотреть альтернативный способ запуска.
- Dev-скрипты писать исключительно на Python, без bash-only реализаций.
- Запуск инструментов и утилит — через `python -m ...` с привязкой к активному интерпретатору/виртуальному окружению.

## Объём поставки T0.1
- README с инструкцией по запуску bridge+core в dev.
- SPEC.md (данный документ), ARCHITECTURE.md, три ADR.

## Объём поставки T0.2
- CI-скелет, описанный выше, с подключёнными линтерами (ruff/black, eslint).
